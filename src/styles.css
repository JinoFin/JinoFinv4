/* ===== Theme tokens (dark default) ===== */
:root {
  /* colors */
  --color-bg: #0b0f19;
  --color-fg: #ffffff;
  --color-fg-muted: #9aa0a6;
  --color-accent: #ffffff;
  --color-surface: #121826;
  --color-surface-elevated: #141c2b;
  --color-border: #222938;
  --color-danger: #ef4444;
  --color-success: #22c55e;

  /* typography */
  --font-base: 16px;
  --font-sm: 12.5px;
  --font-lg: 17px;
  --font-xl: 18.5px;

  --line-base: 1.5;
  --line-tight: 1.1;
  --line-snug: 1.25;
  --heading-letter-spacing: 0.2px;

  /* spacing */
  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 24px;

  /* radii */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;

  /* shadows */
  --shadow-xs: 0 1px 2px rgba(0,0,0,0.25);
  --shadow-s: 0 8px 24px rgba(0,0,0,0.30);
  --shadow-m: 0 18px 40px rgba(0,0,0,0.35);

  /* z-index */
  --z-header: 20;
  --z-nav: 30;
  --z-toast: 40;
  --z-modal: 50;

  /* layout */
  --nav-height: 72px;
}

:root[data-theme='light'] {
  --color-bg: #fafafa;
  --color-fg: #111111;
  --color-fg-muted: #666666;
  --color-accent: #000000;
  --color-surface: #ffffff;
  --color-surface-elevated: #ffffff;
  --color-border: #e5e7eb;
  --color-danger: #dc2626;
  --color-success: #16a34a;
}

:root[data-theme='playful'] {
  --color-bg: #0b1020;
  --color-fg: #fefefe;
  --color-fg-muted: #a0aec0;
  --color-accent: #ffd60a;
  --color-surface: #141a2f;
  --color-surface-elevated: #141a2f;
  --color-border: #232946;
  --color-danger: #ff5d73;
  --color-success: #66e3a4;
}

/* ===== Base ===== */
* { box-sizing: border-box; }
html, body, #root { height: 100%; }

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  font-size: var(--font-base);
  line-height: var(--line-base);
  background: var(--color-bg);
  color: var(--color-fg);
  -webkit-font-smoothing: antialiased;
}

button, input, select, textarea { font: inherit; color: inherit; }
button, a { cursor: pointer; }
:focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; }

/* ===== App Shell ===== */
.app-shell {
  max-width: 520px;
  margin: 0 auto;
  min-height: 100%;
  display: flex;
  flex-direction: column;
  padding: 0 env(safe-area-inset-right) calc(var(--nav-height) + env(safe-area-inset-bottom)) env(safe-area-inset-left);
}

.app-header {
  position: sticky; top: 0; z-index: var(--z-header);
  padding: calc(env(safe-area-inset-top) + var(--space-3)) var(--space-4) var(--space-3);
  backdrop-filter: blur(14px);
  background: color-mix(in srgb, var(--color-bg) 82%, transparent);
  display: flex; gap: var(--space-3); align-items: center; justify-content: space-between;
  border-bottom: 1px solid var(--color-border);
}

.brand { font-size: var(--font-xl); font-weight: 800; letter-spacing: var(--heading-letter-spacing); line-height: var(--line-tight); }
.app-header-meta { font-size: var(--font-sm); color: var(--color-fg-muted); display: flex; align-items: center; gap: var(--space-1); }

.app-content {
  flex: 1;
  padding: var(--space-4);
  padding-top: var(--space-3);
  display: flex; flex-direction: column; gap: var(--space-4);
}

section { display: flex; flex-direction: column; gap: var(--space-3); }

/* ===== Cards / Typography ===== */
.app-card {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-xs);
  padding: var(--space-4);
  display: flex; flex-direction: column; gap: var(--space-3);
  transition: box-shadow .2s ease, transform .15s ease;
}
.app-card.elevated { box-shadow: var(--shadow-s); }
.app-card:active { transform: scale(0.985); }

.card-header { display: flex; align-items: center; justify-content: space-between; gap: var(--space-2); }
.card-title { margin: 0; font-size: var(--font-lg); line-height: var(--line-snug); font-weight: 700; letter-spacing: var(--heading-letter-spacing); }

.small { font-size: var(--font-sm); color: var(--color-fg-muted); }
.muted { color: var(--color-fg-muted); }

.row { display: flex; flex-wrap: wrap; gap: var(--space-2); }
.row > * { flex: 1 1 0; }

/* ===== Buttons & Inputs ===== */
.button {
  border: none; border-radius: var(--radius-md);
  padding: 14px; min-height: 44px;
  font-weight: 700;
  background: var(--color-accent); color: var(--color-bg);
  display: inline-flex; align-items: center; justify-content: center; gap: var(--space-2);
  transition: transform .15s ease, box-shadow .2s ease, background .2s ease;
  box-shadow: var(--shadow-xs);
}
.button:active { transform: scale(0.98); }

.button.btn-outline {
  background: transparent; color: var(--color-fg);
  border: 1px solid var(--color-border); box-shadow: none;
}
.button.btn-muted {
  background: color-mix(in srgb, var(--color-fg-muted) 22%, var(--color-surface) 78%);
  color: var(--color-fg);
}
.button.btn-danger { background: var(--color-danger); color: #fff; }
.button.btn-success { background: var(--color-success); color: #02221a; }

input, select, textarea {
  width: 100%; min-height: 44px;
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  background: color-mix(in srgb, var(--color-surface) 92%, transparent);
  padding: 14px var(--space-3);
  transition: border-color .2s ease, box-shadow .2s ease;
}
input:focus-visible, select:focus-visible, textarea:focus-visible {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-accent) 28%, transparent);
  outline: none;
}
textarea { resize: vertical; min-height: 120px; }

label { font-size: var(--font-sm); color: var(--color-fg-muted); font-weight: 600; letter-spacing: .01em; }

/* ===== Badges ===== */
.badge-row { display: flex; gap: var(--space-2); flex-wrap: wrap; }
.badge {
  border-radius: 999px; border: 1px solid var(--color-border);
  padding: 8px var(--space-3); background: transparent; color: inherit; min-height: 36px; font-weight: 500;
}
.badge.active {
  background: color-mix(in srgb, var(--color-accent) 16%, transparent);
  border-color: color-mix(in srgb, var(--color-accent) 40%, var(--color-border));
}

/* ===== Navbar ===== */
.navbar {
  position: fixed; left: 50%; transform: translateX(-50%); bottom: 0;
  width: 100%; max-width: 520px;
  display: grid; grid-template-columns: repeat(4, 1fr);
  background: color-mix(in srgb, var(--color-bg) 90%, transparent);
  backdrop-filter: blur(16px);
  border-top: 1px solid var(--color-border);
  box-shadow: var(--shadow-xs);
  padding: 4px var(--space-3) calc(env(safe-area-inset-bottom) + 8px);
  gap: var(--space-2);
  z-index: var(--z-nav);
}
.navbar button {
  background: transparent; border: none; color: var(--color-fg-muted);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 6px; padding: var(--space-2) var(--space-1); border-radius: var(--radius-md); min-height: 44px;
}
.navbar button span { font-size: var(--font-sm); line-height: var(--line-tight); }
.navbar button.active { color: var(--color-fg); }
.navbar button.active::after {
  content: ''; position: absolute; bottom: 4px; left: 16%; right: 16%;
  height: 3px; border-radius: 999px; background: var(--color-accent);
}
.navbar button:focus-visible { box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-accent) 35%, transparent); }
.nav-icon { width: 24px; height: 24px; }

/* ===== Lists / Amounts ===== */
.list { display: flex; flex-direction: column; gap: var(--space-2); }
.list-item {
  display: grid; grid-template-columns: 1fr auto; gap: var(--space-2);
  background: var(--color-surface-elevated);
  border-radius: var(--radius-lg);
  padding: var(--space-3);
  border: 1px solid color-mix(in srgb, var(--color-border) 60%, transparent);
  box-shadow: var(--shadow-xs);
  transition: transform .15s ease, box-shadow .2s ease;
}
.list-item:active { transform: scale(0.985); }
.list-item strong { font-size: var(--font-lg); line-height: var(--line-snug); }

.amount-pos { color: var(--color-success); font-weight: 700; }
.amount-neg { color: var(--color-danger); font-weight: 700; }

/* ===== Stats & Progress ===== */
.stat-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: var(--space-3);
}
.stat-card {
  background: var(--color-surface-elevated);
  border-radius: var(--radius-lg);
  border: 1px solid color-mix(in srgb, var(--color-border) 60%, transparent);
  padding: var(--space-3);
  display: flex; flex-direction: column; gap: var(--space-1);
  box-shadow: var(--shadow-xs);
}
.progress-bar {
  width: 100%; height: 10px; border-radius: 999px;
  background: color-mix(in srgb, var(--color-border) 40%, transparent); overflow: hidden;
}
.progress-bar .value { height: 100%; border-radius: inherit; background: var(--color-accent); transition: width .4s ease; }

/* ===== Quick Amount Chips ===== */
.quick-chips { display: flex; flex-wrap: wrap; gap: var(--space-2); }
.quick-chip {
  border: 1px solid var(--color-border); border-radius: 999px;
  padding: 10px var(--space-3); background: color-mix(in srgb, var(--color-accent) 10%, transparent);
  color: var(--color-fg); min-height: 44px;
}
.quick-chip:active { transform: scale(0.95); }

.inline-field { display: flex; flex-direction: column; gap: var(--space-2); }

/* ===== Filters grid ===== */
.filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-2); }

/* ===== Empty state ===== */
.empty-state {
  padding: var(--space-5) var(--space-4);
  border-radius: var(--radius-lg);
  background: var(--color-surface);
  text-align: center;
  display: flex; flex-direction: column; gap: var(--space-3); align-items: center;
  border: 1px solid var(--color-border); box-shadow: var(--shadow-xs);
}
.empty-state svg { width: 48px; height: 48px; color: var(--color-accent); }

/* ===== Toasts ===== */
.toast-stack {
  position: fixed;
  inset: auto var(--space-4) calc(var(--nav-height) + env(safe-area-inset-bottom) + var(--space-4)) var(--space-4);
  display: flex; flex-direction: column; gap: var(--space-2);
  z-index: var(--z-toast);
}
.toast {
  border-radius: var(--radius-lg);
  background: color-mix(in srgb, var(--color-surface-elevated) 92%, transparent);
  border: 1px solid color-mix(in srgb, var(--color-border) 70%, transparent);
  box-shadow: var(--shadow-s);
  padding: var(--space-3) var(--space-4);
  display: flex; align-items: center; justify-content: space-between; gap: var(--space-3);
  min-height: 56px;
}
.toast.success { border-color: color-mix(in srgb, var(--color-success) 40%, transparent); }
.toast.error { border-color: color-mix(in srgb, var(--color-danger) 40%, transparent); }
.toast button {
  min-height: 36px; padding: 0 var(--space-3);
  border-radius: var(--radius-sm); border: none;
  background: color-mix(in srgb, var(--color-accent) 45%, transparent); color: var(--color-bg);
}

/* ===== Modals / Sheets ===== */
.overlay {
  position: fixed; inset: 0; background: rgba(6,10,22,0.55);
  display: flex; align-items: flex-end; justify-content: center;
  padding: env(safe-area-inset-bottom) var(--space-4) var(--space-4);
  z-index: var(--z-modal);
}
.overlay.centered { align-items: center; }

.sheet {
  width: 100%; max-width: 520px;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-m);
  padding: var(--space-5) var(--space-4) var(--space-4);
  animation: slideUp .26s ease;
  display: flex; flex-direction: column; gap: var(--space-3);
}
.modal-card {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: var(--space-4);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-m);
  max-width: 520px; width: min(92vw, 480px);
}

@keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

/* ===== Carousel / Dots (Help sheet) ===== */
.carousel { position: relative; height: 160px; overflow: hidden; }
.slide {
  position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; text-align: center;
  padding: 0 var(--space-4); opacity: 0; transform: translateX(12px); transition: opacity .25s ease, transform .25s ease;
}
.slide.active { opacity: 1; transform: translateX(0); }
.dots { display: flex; gap: var(--space-2); justify-content: center; }
.dot { width: 8px; height: 8px; border-radius: 50%; background: color-mix(in srgb, var(--color-border) 70%, transparent); }
.dot.active { background: var(--color-accent); }

/* ===== Skeleton / Charts ===== */
.skeleton { position: relative; overflow: hidden; border-radius: var(--radius-md); background: color-mix(in srgb, var(--color-border) 40%, transparent); }
.skeleton::after {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent);
  transform: translateX(-100%); animation: shimmer 1.2s infinite;
}
@keyframes shimmer { 100% { transform: translateX(100%); } }

.chart-shell { height: 220px; display: flex; align-items: center; justify-content: center; }

/* ===== Pull to refresh hint ===== */
.pull-refresh-hint {
  position: sticky; top: calc(env(safe-area-inset-top) + 0px);
  display: flex; align-items: center; justify-content: center; text-align: center;
  font-size: var(--font-sm); color: var(--color-fg-muted); padding: var(--space-1) 0;
  opacity: 0; transition: opacity .2s ease;
}
.pull-refresh-hint.visible { opacity: 1; }

/* ===== CSV preview table ===== */
.table-preview { width: 100%; border-collapse: collapse; font-size: var(--font-sm); }
.table-preview th, .table-preview td { border: 1px solid var(--color-border); padding: 8px; text-align: left; }
.table-preview thead { background: color-mix(in srgb, var(--color-accent) 12%, transparent); }
.helper-text { font-size: var(--font-sm); color: var(--color-fg-muted); }

/* ===== Foldable (Left to spend) ===== */
.toggle-row { display: flex; justify-content: space-between; align-items: center; gap: var(--space-2); }

.foldable {
  border-radius: var(--radius-lg);
  background: var(--color-surface-elevated);
  border: 1px solid color-mix(in srgb, var(--color-border) 60%, transparent);
  box-shadow: var(--shadow-xs);
}
.foldable summary { cursor: pointer; padding: var(--space-3); font-weight: 600; }
.foldable[open] summary { border-bottom: 1px solid var(--color-border); }
.foldable-content { padding: var(--space-3); display: flex; flex-direction: column; gap: var(--space-2); }

.bar-row { display: grid; grid-template-columns: 120px 1fr auto; align-items: center; gap: var(--space-2); }
.bar { height: 10px; border-radius: 999px; background: color-mix(in srgb, var(--color-border) 40%, transparent); overflow: hidden; }
.bar .fill { height: 100%; border-radius: inherit; background: var(--color-accent); transition: width .4s ease; }

/* ===== Utilities ===== */
.text-right { text-align: right; }
.center { text-align: center; }
.flex-between { display: flex; justify-content: space-between; gap: var(--space-2); align-items: center; }

/* Wider viewport container chrome */
@media (min-width: 640px) {
  .app-shell { border: 1px solid var(--color-border); border-radius: var(--radius-lg); margin-top: 24px; margin-bottom: 24px; overflow: hidden; }
  .app-header { border-radius: var(--radius-lg) var(--radius-lg) 0 0; }
}
